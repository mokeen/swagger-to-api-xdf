# 更新日志

此文件记录了"Va Swagger to API(vue)"扩展的所有重要更改。

## [2.0.0] - 2025-10-13

### 🎉 重大重构版本

这是一个完全重构的版本，全面优化了 API 生成逻辑，提升了代码质量、可维护性和生成代码的准确性。

### 🔥 核心重构

- **ApiGenerationService 完全重构**：
  - 消除所有硬编码值，提取为常量配置
  - 将复杂逻辑拆分为独立的工具方法
  - 优化类型池和 API 池的构建逻辑
  - 统一命名规范和转换策略

### ✨ 类型系统重大改进

- **完善泛型类型处理**：
  - 支持嵌套泛型类型（如 `Result<BasePageRespDTO<UserDTO>>`）
  - 自动识别泛型包装类型（`ReplyEntity`、`Result`、`PageResult` 等）
  - 对于无泛型参数的响应类型自动补充 `<void>`（如 `ReplyEntity<void>`）
  - 正确处理 `Map<K, V>` 类型的泛型参数（不对基础类型添加 `Types.` 前缀）

- **智能类型前缀处理**：
  - 所有自定义类型自动添加 `Types.` 前缀
  - 基础 TypeScript 类型（`string`、`number`、`boolean` 等）不添加前缀
  - `PlainObject` 和 `Map` 等自定义类型正确识别并添加前缀
  - 泛型参数内的类型递归处理，确保前缀正确

- **类型依赖自动收集**：
  - 自动识别并生成所有依赖的类型定义
  - 支持数组类型的依赖提取（如 `CommentDTO[]` 会自动生成 `CommentDTO`）
  - 完整的类型树构建，避免遗漏类型定义

### 🎯 参数处理优化

- **GET/DELETE 方法参数优化**：
  - 使用具体的参数名称而非通用的 `req`
  - 正确处理路径参数和查询参数
  - 路径参数正确包含在 payload 对象中
  - 支持数组类型参数的正确类型推导（如 `classUidList?: string[]`）

- **POST/PUT 方法参数优化**：
  - 非必需参数添加 `| undefined` 类型
  - 支持多个 body 参数的场景
  - 参数名称使用 Swagger 定义的实际名称

- **可选参数处理**：
  - 方法签名中正确使用 `?` 标记可选参数
  - 类型定义中正确处理可选属性

### 🏗️ Controller 命名标准化

- **统一命名规则**：
  - Controller 名称统一使用小驼峰格式（camelCase）
  - 保留 `Controller` 后缀（如 `assistantAgendaController`）
  - 已存在 API 的识别和合并逻辑统一命名标准
  - 避免命名不一致导致的 API 标记失效

- **类型定义命名**：
  - Controller 类型定义使用大驼峰格式（PascalCase）
  - 示例：`AssistantAgendaController`、`BiDockingController`

### 📦 动态导出生成

- **智能 index.ts 生成**：
  - 根据 Swagger 的 `description` 或 `title` 动态生成导出名称
  - 自动转换为大驼峰格式（PascalCase）
  - 支持多种命名格式输入（中划线、下划线、小驼峰、空格分隔等）
  - 生成两个导出：
    - `{DocName}Types`：类型命名空间导出
    - `{DocName}Services`：完整服务导出（默认导出）
  - 示例：`study-course` → `StudyCourseTypes` 和 `StudyCourseServices`

### 🔧 代码质量提升

- **消除冗余逻辑**：
  - 提取通用方法避免重复代码
  - 统一类型转换和命名规范处理
  - 优化数据结构和算法

- **增强错误处理**：
  - 完善边界情况处理
  - 改进错误提示和日志输出
  - 增强类型安全检查

- **提高可维护性**：
  - 添加详细的 JSDoc 注释
  - 方法职责单一，易于理解和测试
  - 常量集中管理，便于配置

### 🧪 测试和验证

- **完善测试覆盖**：
  - 添加类型生成测试
  - 添加 API 生成测试
  - 添加参数处理测试
  - 添加命名转换测试
  - 全量测试验证（基于 demo.json）

### 📝 Bug 修复

- **修复类型前缀问题**：修复嵌套泛型类型中缺少 `Types.` 前缀的问题
- **修复参数命名问题**：修复 GET/DELETE 方法参数名称不准确的问题
- **修复 Controller 命名问题**：修复 Controller 命名不一致导致的合并失败
- **修复类型缺失问题**：修复某些依赖类型未生成的问题（如 `CommentDTO`）
- **修复泛型参数问题**：修复 `Map<string, string>` 被错误处理为 `Map<Types.string, string>` 的问题
- **修复可选参数问题**：修复非必需参数缺少 `undefined` 类型的问题

### 🎨 用户体验改进

- **更清晰的代码输出**：生成的代码结构更清晰，易于阅读和维护
- **更准确的类型推导**：减少手动类型修正的需求
- **更智能的命名**：导出名称和文件夹名称与项目语义相关

### ⚠️ 破坏性变更

- **index.ts 导出结构变化**：
  - 旧版本：`export const Smart = APIs`
  - 新版本：`export const {DocName}Types = Types` 和 `export const {DocName}Services = { Types, ...APIs }`
  - 需要更新导入语句以适配新的导出格式

- **Controller 命名格式变化**：
  - 统一使用小驼峰格式，保留 Controller 后缀
  - 可能需要更新引用 Controller 的代码

## [1.0.2] - 2024-12-25

### 🔧 修复和优化

- **修复控制器重复生成问题**：优化控制器名称标准化机制，确保已存在的控制器与新选择的控制器正确合并
- **增强方法名唯一性**：采用路径哈希算法生成唯一方法名，格式为 `{cleanOperationId}_{pathHash}`，避免方法名冲突
- **完善 operationId 清理**：彻底处理 `UsingPOST_1` 等后缀，支持更复杂的命名场景
- **优化已存在API标记**：改为按需标记策略，只标记当前展开的控制器，提升性能
- **增强数据合并策略**：从增量更新改为"数据合并+全量重建"，提高稳定性和可维护性

### ✨ 新增功能

- **刷新时清除筛选**：刷新文档时自动清除所有控制器和API级别的筛选条件
- **完整泛型支持**：恢复并增强复杂泛型类型处理，支持 `Result<T>`、`PageResult<T>`、`BasePageRespDTO<T>` 等
- **智能控制器匹配**：优化已存在API的识别和标记逻辑，确保准确性

### 🎯 用户体验改进

- **Toast通知优化**：调整通知位置避免与文档头部重叠
- **导出成功反馈**：导出成功后自动取消API选择状态
- **筛选状态管理**：提供更直观的筛选清除功能

### 🏗️ 技术架构优化

- **方法名生成算法**：使用稳定的路径哈希确保相同输入产生相同输出
- **控制器名称标准化**：统一现有文件解析和新API生成的命名规则
- **错误处理增强**：完善各环节的错误处理和用户提示

## [1.0.0] - 2024-12-19

### 新增功能

- 🎉 Va Swagger to API 扩展首次发布
- ✨ 支持 Swagger/OpenAPI v2 文档解析
- 🔄 智能增量代码生成，支持智能合并
- 🎯 选择性 API 生成（可选择特定接口）
- 📁 有序的输出结构（index.ts、types.ts、apis.ts）
- 🏷️ 智能类型解析，支持泛型包装类型
- 🔍 高级用户界面功能：
  - 控制器级别和接口级别搜索
  - 批量选择/取消选择操作
  - 智能滚动和导航
  - 标签页切换时不刷新
- 🛡️ 类型安全的 TypeScript 代码生成
- 📦 支持复杂嵌套类型和数组
- 🎨 自动方法名清理和冲突解决
- 🔧 防止 ESLint 和 TypeScript 错误
- 💾 持久化配置管理
- 🌐 支持各种 Swagger JSON 端点

### 主要特性

- **智能类型系统**：自动识别 `Result<T>`、`PageResult<T>`、`ReplyEntity<T>`、`BasePageRespDTO<T>` 包装类型
- **增量更新**：添加新接口时不会丢失现有接口
- **灵活导入**：使用默认导入方式引入 HTTP 客户端（`import $http from '../request'`）
- **动态 basePath**：自动从 Swagger JSON 中提取和处理 basePath
- **清洁代码**：生成符合 ESLint 规范的代码，具有正确的 TypeScript 类型
- **Vue + Axios 优化**：专为使用 Axios 的 Vue.js 项目设计

### 技术细节

- 支持 Swagger v2 规范
- 生成 TypeScript 接口和 API 客户端
- 处理 GET 请求的展开参数
- 管理 POST/PUT/DELETE 请求的 DTO
- 自动处理路径参数和查询参数
- 全面的错误处理和验证

### 使用场景

- Vue 项目的 API 接口生成
- 基于 Swagger 文档的 TypeScript 类型定义
- 团队协作中的接口规范统一
- 减少手动编写接口代码的工作量

### 支持的功能

- ✅ Swagger v2 规范解析
- ✅ 按需选择接口生成
- ✅ 增量更新，保留现有代码
- ✅ 智能类型推导
- ✅ 控制器分组管理
- ✅ 搜索和筛选功能
- ✅ 批量操作支持
